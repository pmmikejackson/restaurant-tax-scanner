<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Texas Restaurant Tax Scanner</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçΩÔ∏è Texas Restaurant Tax Scanner</h1>
            <p>Identify all applicable taxes for your restaurant POS configuration</p>
        </div>

        <div class="content">
            <div class="location-section">
                <h2 class="section-title">
                    üìç Restaurant Location
                </h2>
                
                <div class="location-inputs">
                    <div class="input-group">
                        <label for="county">County</label>
                        <input type="text" id="county" list="county-list" placeholder="Type or select county..." autocomplete="off">
                        <datalist id="county-list">
                            <option value="anderson">Anderson County</option>
                            <option value="andrews">Andrews County</option>
                            <option value="angelina">Angelina County</option>
                            <option value="aransas">Aransas County</option>
                            <option value="archer">Archer County</option>
                            <option value="armstrong">Armstrong County</option>
                            <option value="atascosa">Atascosa County</option>
                            <option value="austin">Austin County</option>
                            <option value="bailey">Bailey County</option>
                            <option value="bandera">Bandera County</option>
                            <option value="bastrop">Bastrop County</option>
                            <option value="baylor">Baylor County</option>
                            <option value="bee">Bee County</option>
                            <option value="bell">Bell County</option>
                            <option value="bexar">Bexar County</option>
                            <option value="blanco">Blanco County</option>
                            <option value="borden">Borden County</option>
                            <option value="bosque">Bosque County</option>
                            <option value="bowie">Bowie County</option>
                            <option value="brazoria">Brazoria County</option>
                            <option value="brazos">Brazos County</option>
                            <option value="brewster">Brewster County</option>
                            <option value="briscoe">Briscoe County</option>
                            <option value="brown">Brown County</option>
                            <option value="burleson">Burleson County</option>
                            <option value="burnet">Burnet County</option>
                            <option value="caldwell">Caldwell County</option>
                            <option value="calhoun">Calhoun County</option>
                            <option value="callahan">Callahan County</option>
                            <option value="cameron">Cameron County</option>
                            <option value="camp">Camp County</option>
                            <option value="carson">Carson County</option>
                            <option value="cass">Cass County</option>
                            <option value="castro">Castro County</option>
                            <option value="chambers">Chambers County</option>
                            <option value="cherokee">Cherokee County</option>
                            <option value="childress">Childress County</option>
                            <option value="clay">Clay County</option>
                            <option value="cochran">Cochran County</option>
                            <option value="coke">Coke County</option>
                            <option value="coleman">Coleman County</option>
                            <option value="collin">Collin County</option>
                            <option value="collingsworth">Collingsworth County</option>
                            <option value="colorado">Colorado County</option>
                            <option value="comal">Comal County</option>
                            <option value="comanche">Comanche County</option>
                            <option value="concho">Concho County</option>
                            <option value="cooke">Cooke County</option>
                            <option value="coryell">Coryell County</option>
                            <option value="cottle">Cottle County</option>
                            <option value="crane">Crane County</option>
                            <option value="crockett">Crockett County</option>
                            <option value="crosby">Crosby County</option>
                            <option value="culberson">Culberson County</option>
                            <option value="dallam">Dallam County</option>
                            <option value="dallas">Dallas County</option>
                            <option value="dawson">Dawson County</option>
                            <option value="deaf-smith">Deaf Smith County</option>
                            <option value="delta">Delta County</option>
                            <option value="denton">Denton County</option>
                            <option value="dewitt">DeWitt County</option>
                            <option value="dickens">Dickens County</option>
                            <option value="donley">Donley County</option>
                            <option value="eastland">Eastland County</option>
                            <option value="ector">Ector County</option>
                            <option value="edwards">Edwards County</option>
                            <option value="el-paso">El Paso County</option>
                            <option value="ellis">Ellis County</option>
                            <option value="erath">Erath County</option>
                            <option value="falls">Falls County</option>
                            <option value="fannin">Fannin County</option>
                            <option value="fayette">Fayette County</option>
                            <option value="fisher">Fisher County</option>
                            <option value="floyd">Floyd County</option>
                            <option value="foard">Foard County</option>
                            <option value="fort-bend">Fort Bend County</option>
                            <option value="franklin">Franklin County</option>
                            <option value="freestone">Freestone County</option>
                            <option value="frio">Frio County</option>
                            <option value="gaines">Gaines County</option>
                            <option value="galveston">Galveston County</option>
                            <option value="garza">Garza County</option>
                            <option value="gillespie">Gillespie County</option>
                            <option value="glasscock">Glasscock County</option>
                            <option value="goliad">Goliad County</option>
                            <option value="gonzales">Gonzales County</option>
                            <option value="gray">Gray County</option>
                            <option value="grayson">Grayson County</option>
                            <option value="gregg">Gregg County</option>
                            <option value="grimes">Grimes County</option>
                            <option value="guadalupe">Guadalupe County</option>
                            <option value="hale">Hale County</option>
                            <option value="hall">Hall County</option>
                            <option value="hamilton">Hamilton County</option>
                            <option value="hansford">Hansford County</option>
                            <option value="hardeman">Hardeman County</option>
                            <option value="hardin">Hardin County</option>
                            <option value="harris">Harris County</option>
                            <option value="harrison">Harrison County</option>
                            <option value="hartley">Hartley County</option>
                            <option value="haskell">Haskell County</option>
                            <option value="hays">Hays County</option>
                            <option value="hemphill">Hemphill County</option>
                            <option value="henderson">Henderson County</option>
                            <option value="hidalgo">Hidalgo County</option>
                            <option value="hill">Hill County</option>
                            <option value="hockley">Hockley County</option>
                            <option value="hood">Hood County</option>
                            <option value="hopkins">Hopkins County</option>
                            <option value="houston">Houston County</option>
                            <option value="howard">Howard County</option>
                            <option value="hudspeth">Hudspeth County</option>
                            <option value="hunt">Hunt County</option>
                            <option value="hutchinson">Hutchinson County</option>
                            <option value="irion">Irion County</option>
                            <option value="jack">Jack County</option>
                            <option value="jackson">Jackson County</option>
                            <option value="jasper">Jasper County</option>
                            <option value="jeff-davis">Jeff Davis County</option>
                            <option value="jefferson">Jefferson County</option>
                            <option value="johnson">Johnson County</option>
                            <option value="jones">Jones County</option>
                            <option value="karnes">Karnes County</option>
                            <option value="kaufman">Kaufman County</option>
                            <option value="kendall">Kendall County</option>
                            <option value="kenedy">Kenedy County</option>
                            <option value="kent">Kent County</option>
                            <option value="kerr">Kerr County</option>
                            <option value="kimble">Kimble County</option>
                            <option value="king">King County</option>
                            <option value="kinney">Kinney County</option>
                            <option value="kleberg">Kleberg County</option>
                            <option value="knox">Knox County</option>
                            <option value="la-salle">La Salle County</option>
                            <option value="lamar">Lamar County</option>
                            <option value="lamb">Lamb County</option>
                            <option value="lampasas">Lampasas County</option>
                            <option value="lavaca">Lavaca County</option>
                            <option value="lee">Lee County</option>
                            <option value="leon">Leon County</option>
                            <option value="liberty">Liberty County</option>
                            <option value="limestone">Limestone County</option>
                            <option value="lipscomb">Lipscomb County</option>
                            <option value="live-oak">Live Oak County</option>
                            <option value="llano">Llano County</option>
                            <option value="loving">Loving County</option>
                            <option value="lubbock">Lubbock County</option>
                            <option value="lynn">Lynn County</option>
                            <option value="madison">Madison County</option>
                            <option value="marion">Marion County</option>
                            <option value="martin">Martin County</option>
                            <option value="mason">Mason County</option>
                            <option value="matagorda">Matagorda County</option>
                            <option value="maverick">Maverick County</option>
                            <option value="mcculloch">McCulloch County</option>
                            <option value="mclennan">McLennan County</option>
                            <option value="mcmullen">McMullen County</option>
                            <option value="medina">Medina County</option>
                            <option value="menard">Menard County</option>
                            <option value="midland">Midland County</option>
                            <option value="milam">Milam County</option>
                            <option value="mills">Mills County</option>
                            <option value="mitchell">Mitchell County</option>
                            <option value="montague">Montague County</option>
                            <option value="montgomery">Montgomery County</option>
                            <option value="moore">Moore County</option>
                            <option value="morris">Morris County</option>
                            <option value="motley">Motley County</option>
                            <option value="nacogdoches">Nacogdoches County</option>
                            <option value="navarro">Navarro County</option>
                            <option value="newton">Newton County</option>
                            <option value="nolan">Nolan County</option>
                            <option value="nueces">Nueces County</option>
                            <option value="ochiltree">Ochiltree County</option>
                            <option value="oldham">Oldham County</option>
                            <option value="orange">Orange County</option>
                            <option value="palo-pinto">Palo Pinto County</option>
                            <option value="panola">Panola County</option>
                            <option value="parker">Parker County</option>
                            <option value="parmer">Parmer County</option>
                            <option value="pecos">Pecos County</option>
                            <option value="polk">Polk County</option>
                            <option value="potter">Potter County</option>
                            <option value="presidio">Presidio County</option>
                            <option value="rains">Rains County</option>
                            <option value="randall">Randall County</option>
                            <option value="reagan">Reagan County</option>
                            <option value="real">Real County</option>
                            <option value="red-river">Red River County</option>
                            <option value="reeves">Reeves County</option>
                            <option value="refugio">Refugio County</option>
                            <option value="roberts">Roberts County</option>
                            <option value="robertson">Robertson County</option>
                            <option value="rockwall">Rockwall County</option>
                            <option value="runnels">Runnels County</option>
                            <option value="rusk">Rusk County</option>
                            <option value="sabine">Sabine County</option>
                            <option value="san-augustine">San Augustine County</option>
                            <option value="san-jacinto">San Jacinto County</option>
                            <option value="san-patricio">San Patricio County</option>
                            <option value="san-saba">San Saba County</option>
                            <option value="schleicher">Schleicher County</option>
                            <option value="scurry">Scurry County</option>
                            <option value="shackelford">Shackelford County</option>
                            <option value="shelby">Shelby County</option>
                            <option value="sherman">Sherman County</option>
                            <option value="smith">Smith County</option>
                            <option value="somervell">Somervell County</option>
                            <option value="starr">Starr County</option>
                            <option value="stephens">Stephens County</option>
                            <option value="sterling">Sterling County</option>
                            <option value="stonewall">Stonewall County</option>
                            <option value="sutton">Sutton County</option>
                            <option value="swisher">Swisher County</option>
                            <option value="tarrant">Tarrant County</option>
                            <option value="taylor">Taylor County</option>
                            <option value="terrell">Terrell County</option>
                            <option value="terry">Terry County</option>
                            <option value="throckmorton">Throckmorton County</option>
                            <option value="titus">Titus County</option>
                            <option value="tom-green">Tom Green County</option>
                            <option value="travis">Travis County</option>
                            <option value="trinity">Trinity County</option>
                            <option value="tyler">Tyler County</option>
                            <option value="upshur">Upshur County</option>
                            <option value="upton">Upton County</option>
                            <option value="uvalde">Uvalde County</option>
                            <option value="val-verde">Val Verde County</option>
                            <option value="van-zandt">Van Zandt County</option>
                            <option value="victoria">Victoria County</option>
                            <option value="walker">Walker County</option>
                            <option value="waller">Waller County</option>
                            <option value="ward">Ward County</option>
                            <option value="washington">Washington County</option>
                            <option value="webb">Webb County</option>
                            <option value="wharton">Wharton County</option>
                            <option value="wheeler">Wheeler County</option>
                            <option value="wichita">Wichita County</option>
                            <option value="wilbarger">Wilbarger County</option>
                            <option value="willacy">Willacy County</option>
                            <option value="williamson">Williamson County</option>
                            <option value="wilson">Wilson County</option>
                            <option value="winkler">Winkler County</option>
                            <option value="wise">Wise County</option>
                            <option value="wood">Wood County</option>
                            <option value="yoakum">Yoakum County</option>
                            <option value="young">Young County</option>
                            <option value="zapata">Zapata County</option>
                            <option value="zavala">Zavala County</option>
                        </datalist>
                    </div>

                    <div class="input-group">
                        <label for="city">City</label>
                        <input type="text" id="city" list="city-list" placeholder="Type or select city..." autocomplete="off">
                        <datalist id="city-list">
                            <!-- Cities will be populated dynamically -->
                        </datalist>
                    </div>

                    <div class="input-group">
                        <label for="zip">ZIP Code</label>
                        <input type="text" id="zip" placeholder="75001" maxlength="5">
                    </div>
                </div>

                <div class="button-row">
                    <button class="btn-location" onclick="useLocation()">
                        üìç Use My Location
                    </button>
                    <button class="btn-scan" onclick="scanTaxes()">
                        üîç Scan Taxes
                    </button>
                </div>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Scanning Texas tax databases...</p>
            </div>

            <div class="results-section" id="results">
                <h2 class="section-title">üí∞ Applicable Taxes</h2>
                <div class="tax-grid" id="taxGrid">
                    <!-- Tax cards will be populated here -->
                </div>

                <div class="export-section">
                    <h3>Export Tax Configuration</h3>
                    <p style="margin: 15px 0; color: #7f8c8d;">Download tax rates in your preferred format for POS configuration</p>
                    <button class="btn btn-primary" onclick="exportJSON()">Export as JSON</button>
                    <button class="btn btn-secondary" onclick="exportCSV()">Export as CSV</button>
                </div>
            </div>

            <div id="statusMessage"></div>
        </div>
    </div>

    <!-- Load configuration securely from API -->
    <script>
        // Secure Google Maps integration using serverless function
        // API key is kept secure on the server side
        
        let map;
        let geocoder;

        // Initialize without loading Google Maps API directly
        function initMap() {
            console.log('Geocoding service initialized (serverless)');
        }
        
        // Load the API when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
        });

        // Serverless reverse geocoding function
        async function reverseGeocode(lat, lng) {
            try {
                const response = await fetch('/.netlify/functions/geocode', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ lat, lng })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }

                // Parse the geocoding results
                parseGeocodingResults(data.results);
                
            } catch (error) {
                console.error('Geocoding error:', error);
                showStatus('‚ùå Could not determine location. Please enter manually.', 'error');
            }
        }

        // Parse geocoding results and populate form
        function parseGeocodingResults(results) {
            if (!results || results.length === 0) {
                showStatus('‚ùå No location data found. Please enter manually.', 'error');
                return;
            }

            let county = null;
            let city = null;
            let zip = null;

            // Extract location components
            for (const result of results) {
                for (const component of result.address_components) {
                    const types = component.types;
                    
                    if (types.includes('administrative_area_level_2')) {
                        // This is the county
                        let countyName = component.long_name.toLowerCase();
                        // Remove "County" from the end if present
                        countyName = countyName.replace(/\s+county$/i, '');
                        // Convert to slug format
                        county = countyName.replace(/\s+/g, '-');
                    }
                    
                    if (types.includes('locality') || types.includes('sublocality')) {
                        city = component.long_name.toLowerCase().replace(/\s+/g, '-');
                    }
                    
                    if (types.includes('postal_code')) {
                        zip = component.long_name;
                    }
                }
            }

            // Populate form fields
            if (county) {
                document.getElementById('county').value = county;
                // Trigger county change to populate cities
                document.getElementById('county').dispatchEvent(new Event('input'));
            }
            
            if (city) {
                setTimeout(() => {
                    document.getElementById('city').value = city;
                }, 100);
            }
            
            if (zip) {
                document.getElementById('zip').value = zip;
            }

            // Show success message
            const countyDisplay = countyNameMapping[county] || county;
            const cityDisplay = city ? city.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase()) : '';
            showStatus(`üìç Location found: ${cityDisplay}${cityDisplay && countyDisplay ? ', ' : ''}${countyDisplay}`, 'success');
        }

        // Use My Location function
        function useLocation() {
            if (!navigator.geolocation) {
                showStatus('Geolocation is not supported by this browser.', 'error');
                return;
            }

            showStatus('üåç Getting your location...', 'success');

            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    showStatus('üìç Location found! Looking up address...', 'success');
                    
                    // Use serverless function for reverse geocoding
                    reverseGeocode(lat, lng);
                },
                function(error) {
                    let errorMsg = 'Unable to get your location. ';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMsg += 'Location access denied by user.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMsg += 'Location information unavailable.';
                            break;
                        case error.TIMEOUT:
                            errorMsg += 'Location request timed out.';
                            break;
                        default:
                            errorMsg += 'Unknown error occurred.';
                            break;
                    }
                    showStatus(errorMsg + ' Please select manually.', 'error');
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 300000
                }
            );
        }
    </script>
    
    <!-- Database API Integration -->
    <script>
        // County name mapping for geocoding
        const countyNameMapping = {
            'anderson': 'Anderson County', 'andrews': 'Andrews County', 'angelina': 'Angelina County', 'aransas': 'Aransas County', 'archer': 'Archer County', 'armstrong': 'Armstrong County', 'atascosa': 'Atascosa County', 'austin': 'Austin County', 'bailey': 'Bailey County', 'bandera': 'Bandera County', 'bastrop': 'Bastrop County', 'baylor': 'Baylor County', 'bee': 'Bee County', 'bell': 'Bell County', 'bexar': 'Bexar County', 'blanco': 'Blanco County', 'borden': 'Borden County', 'bosque': 'Bosque County', 'bowie': 'Bowie County', 'brazoria': 'Brazoria County', 'brazos': 'Brazos County', 'brewster': 'Brewster County', 'briscoe': 'Briscoe County', 'brown': 'Brown County', 'burleson': 'Burleson County', 'burnet': 'Burnet County', 'caldwell': 'Caldwell County', 'calhoun': 'Calhoun County', 'callahan': 'Callahan County', 'cameron': 'Cameron County', 'camp': 'Camp County', 'carson': 'Carson County', 'cass': 'Cass County', 'castro': 'Castro County', 'chambers': 'Chambers County', 'cherokee': 'Cherokee County', 'childress': 'Childress County', 'clay': 'Clay County', 'cochran': 'Cochran County', 'coke': 'Coke County', 'coleman': 'Coleman County', 'collin': 'Collin County', 'collingsworth': 'Collingsworth County', 'colorado': 'Colorado County', 'comal': 'Comal County', 'comanche': 'Comanche County', 'concho': 'Concho County', 'cooke': 'Cooke County', 'coryell': 'Coryell County', 'cottle': 'Cottle County', 'crane': 'Crane County', 'crockett': 'Crockett County', 'crosby': 'Crosby County', 'culberson': 'Culberson County', 'dallam': 'Dallam County', 'dallas': 'Dallas County', 'dawson': 'Dawson County', 'deaf-smith': 'Deaf Smith County', 'delta': 'Delta County', 'denton': 'Denton County', 'dewitt': 'DeWitt County', 'dickens': 'Dickens County', 'donley': 'Donley County', 'eastland': 'Eastland County', 'ector': 'Ector County', 'edwards': 'Edwards County', 'el-paso': 'El Paso County', 'ellis': 'Ellis County', 'erath': 'Erath County', 'falls': 'Falls County', 'fannin': 'Fannin County', 'fayette': 'Fayette County', 'fisher': 'Fisher County', 'floyd': 'Floyd County', 'foard': 'Foard County', 'fort-bend': 'Fort Bend County', 'franklin': 'Franklin County', 'freestone': 'Freestone County', 'frio': 'Frio County', 'gaines': 'Gaines County', 'galveston': 'Galveston County', 'garza': 'Garza County', 'gillespie': 'Gillespie County', 'glasscock': 'Glasscock County', 'goliad': 'Goliad County', 'gonzales': 'Gonzales County', 'gray': 'Gray County', 'grayson': 'Grayson County', 'gregg': 'Gregg County', 'grimes': 'Grimes County', 'guadalupe': 'Guadalupe County', 'hale': 'Hale County', 'hall': 'Hall County', 'hamilton': 'Hamilton County', 'hansford': 'Hansford County', 'hardeman': 'Hardeman County', 'hardin': 'Hardin County', 'harris': 'Harris County', 'harrison': 'Harrison County', 'hartley': 'Hartley County', 'haskell': 'Haskell County', 'hays': 'Hays County', 'hemphill': 'Hemphill County', 'henderson': 'Henderson County', 'hidalgo': 'Hidalgo County', 'hill': 'Hill County', 'hockley': 'Hockley County', 'hood': 'Hood County', 'hopkins': 'Hopkins County', 'houston': 'Houston County', 'howard': 'Howard County', 'hudspeth': 'Hudspeth County', 'hunt': 'Hunt County', 'hutchinson': 'Hutchinson County', 'irion': 'Irion County', 'jack': 'Jack County', 'jackson': 'Jackson County', 'jasper': 'Jasper County', 'jeff-davis': 'Jeff Davis County', 'jefferson': 'Jefferson County', 'johnson': 'Johnson County', 'jones': 'Jones County', 'karnes': 'Karnes County', 'kaufman': 'Kaufman County', 'kendall': 'Kendall County', 'kenedy': 'Kenedy County', 'kent': 'Kent County', 'kerr': 'Kerr County', 'kimble': 'Kimble County', 'king': 'King County', 'kinney': 'Kinney County', 'kleberg': 'Kleberg County', 'knox': 'Knox County', 'la-salle': 'La Salle County', 'lamar': 'Lamar County', 'lamb': 'Lamb County', 'lampasas': 'Lampasas County', 'lavaca': 'Lavaca County', 'lee': 'Lee County', 'leon': 'Leon County', 'liberty': 'Liberty County', 'limestone': 'Limestone County', 'lipscomb': 'Lipscomb County', 'live-oak': 'Live Oak County', 'llano': 'Llano County', 'loving': 'Loving County', 'lubbock': 'Lubbock County', 'lynn': 'Lynn County', 'madison': 'Madison County', 'marion': 'Marion County', 'martin': 'Martin County', 'mason': 'Mason County', 'matagorda': 'Matagorda County', 'maverick': 'Maverick County', 'mcculloch': 'McCulloch County', 'mclennan': 'McLennan County', 'mcmullen': 'McMullen County', 'medina': 'Medina County', 'menard': 'Menard County', 'midland': 'Midland County', 'milam': 'Milam County', 'mills': 'Mills County', 'mitchell': 'Mitchell County', 'montague': 'Montague County', 'montgomery': 'Montgomery County', 'moore': 'Moore County', 'morris': 'Morris County', 'motley': 'Motley County', 'nacogdoches': 'Nacogdoches County', 'navarro': 'Navarro County', 'newton': 'Newton County', 'nolan': 'Nolan County', 'nueces': 'Nueces County', 'ochiltree': 'Ochiltree County', 'oldham': 'Oldham County', 'orange': 'Orange County', 'palo-pinto': 'Palo Pinto County', 'panola': 'Panola County', 'parker': 'Parker County', 'parmer': 'Parmer County', 'pecos': 'Pecos County', 'polk': 'Polk County', 'potter': 'Potter County', 'presidio': 'Presidio County', 'rains': 'Rains County', 'randall': 'Randall County', 'reagan': 'Reagan County', 'real': 'Real County', 'red-river': 'Red River County', 'reeves': 'Reeves County', 'refugio': 'Refugio County', 'roberts': 'Roberts County', 'robertson': 'Robertson County', 'rockwall': 'Rockwall County', 'runnels': 'Runnels County', 'rusk': 'Rusk County', 'sabine': 'Sabine County', 'san-augustine': 'San Augustine County', 'san-jacinto': 'San Jacinto County', 'san-patricio': 'San Patricio County', 'san-saba': 'San Saba County', 'schleicher': 'Schleicher County', 'scurry': 'Scurry County', 'shackelford': 'Shackelford County', 'shelby': 'Shelby County', 'sherman': 'Sherman County', 'smith': 'Smith County', 'somervell': 'Somervell County', 'starr': 'Starr County', 'stephens': 'Stephens County', 'sterling': 'Sterling County', 'stonewall': 'Stonewall County', 'sutton': 'Sutton County', 'swisher': 'Swisher County', 'tarrant': 'Tarrant County', 'taylor': 'Taylor County', 'terrell': 'Terrell County', 'terry': 'Terry County', 'throckmorton': 'Throckmorton County', 'titus': 'Titus County', 'tom-green': 'Tom Green County', 'travis': 'Travis County', 'trinity': 'Trinity County', 'tyler': 'Tyler County', 'upshur': 'Upshur County', 'upton': 'Upton County', 'uvalde': 'Uvalde County', 'val-verde': 'Val Verde County', 'van-zandt': 'Van Zandt County', 'victoria': 'Victoria County', 'walker': 'Walker County', 'waller': 'Waller County', 'ward': 'Ward County', 'washington': 'Washington County', 'webb': 'Webb County', 'wharton': 'Wharton County', 'wheeler': 'Wheeler County', 'wichita': 'Wichita County', 'wilbarger': 'Wilbarger County', 'willacy': 'Willacy County', 'williamson': 'Williamson County', 'wilson': 'Wilson County', 'winkler': 'Winkler County', 'wise': 'Wise County', 'wood': 'Wood County', 'yoakum': 'Yoakum County', 'young': 'Young County', 'zapata': 'Zapata County', 'zavala': 'Zavala County'
        };

        // Texas county to city mapping
        const countyToCities = {
            'harris': ['Alvin', 'Atascocita', 'Baytown', 'Bellaire', 'Bunker Hill Village', 'Clear Lake', 'Cloverleaf', 'Conroe', 'Cypress', 'Deer Park', 'Friendswood', 'Galena Park', 'Hedwig Village', 'Hilshire Village', 'Houston', 'Humble', 'Hunters Creek Village', 'Jacinto City', 'Katy', 'Kemah', 'Kingwood', 'La Porte', 'League City', 'Manvel', 'Missouri City', 'Pasadena', 'Pearland', 'Piney Point Village', 'Seabrook', 'South Houston', 'Southside Place', 'Spring', 'Spring Valley', 'Stafford', 'Sugar Land', 'Tomball', 'West University Place'],
            'dallas': ['Addison', 'Balch Springs', 'Carrollton', 'Cockrell Hill', 'Combine', 'Coppell', 'Dallas', 'DeSoto', 'Duncanville', 'Farmers Branch', 'Garland', 'Glenn Heights', 'Grand Prairie', 'Highland Park', 'Hutchins', 'Irving', 'Lancaster', 'Mesquite', 'Plano', 'Richardson', 'Rowlett', 'Sachse', 'Seagoville', 'Sunnyvale', 'University Park', 'Wilmer'],
            'tarrant': ['Arlington', 'Azle', 'Bedford', 'Benbrook', 'Blue Mound', 'Burleson', 'Carrollton', 'Colleyville', 'Crowley', 'Euless', 'Everman', 'Forest Hill', 'Fort Worth', 'Grand Prairie', 'Grapevine', 'Haltom City', 'Hurst', 'Keller', 'Kennedale', 'Lake Worth', 'Mansfield', 'North Richland Hills', 'Richland Hills', 'River Oaks', 'Saginaw', 'Sansom Park', 'Southlake', 'Watauga', 'Westover Hills', 'Westworth Village', 'White Settlement'],
            'bexar': ['Alamo Heights', 'Balcones Heights', 'Castle Hills', 'China Grove', 'Converse', 'Elmendorf', 'Fair Oaks Ranch', 'Grey Forest', 'Helotes', 'Hill Country Village', 'Hollywood Park', 'Kirby', 'Leon Valley', 'Live Oak', 'Macdona', 'Olmos Park', 'San Antonio', 'Schertz', 'Selma', 'Shavano Park', 'Somerset', 'Terrell Hills', 'Universal City', 'Windcrest'],
            'travis': ['Austin', 'Barton Creek', 'Bee Cave', 'Briarcliff', 'Cedar Park', 'Creedmoor', 'Del Valle', 'Elgin', 'Garfield', 'Hornsby Bend', 'Jonestown', 'Lago Vista', 'Lakeway', 'Manor', 'McNeil', 'Mustang Ridge', 'Pflugerville', 'Point Venture', 'Rollingwood', 'Sunset Valley', 'Volente', 'Wells Branch', 'West Lake Hills']
        };

        // Static tax data (simplified version for Netlify deployment)
        let currentTaxData = null;

        // Generate tax data based on county and city
        function generateTaxData(county, city, zip) {
            const baseTaxes = [{
                name: 'Texas State Sales Tax',
                rate: 6.25,
                is_percentage: true,
                description: 'Statewide sales tax applied to all taxable sales',
                applies_to: 'All food and beverage sales',
                type: 'state'
            }];

            const countyTaxes = {
                'harris': [
                    { name: 'Harris County Tax', rate: 1.00, is_percentage: true, description: 'County-level sales tax', applies_to: 'All taxable sales', type: 'county' },
                    { name: 'Metro Transit Tax', rate: 1.00, is_percentage: true, description: 'Transportation authority tax', applies_to: 'All taxable sales', type: 'special' }
                ],
                'dallas': [
                    { name: 'Dallas County Tax', rate: 0.50, is_percentage: true, description: 'County-level sales tax', applies_to: 'All taxable sales', type: 'county' },
                    { name: 'DART Tax', rate: 1.00, is_percentage: true, description: 'Dallas Area Rapid Transit tax', applies_to: 'All taxable sales', type: 'special' }
                ],
                'travis': [
                    { name: 'Travis County Tax', rate: 0.75, is_percentage: true, description: 'County-level sales tax', applies_to: 'All taxable sales', type: 'county' },
                    { name: 'Austin Bag Fee', rate: 0.05, is_percentage: false, description: 'Single-use bag fee', applies_to: 'Per paper/plastic bag provided', type: 'special' }
                ],
                'bexar': [
                    { name: 'Bexar County Tax', rate: 0.75, is_percentage: true, description: 'County-level sales tax', applies_to: 'All taxable sales', type: 'county' },
                    { name: 'San Antonio MTA', rate: 0.50, is_percentage: true, description: 'Metropolitan Transit Authority tax', applies_to: 'All taxable sales', type: 'special' }
                ],
                'tarrant': [
                    { name: 'Tarrant County Tax', rate: 0.50, is_percentage: true, description: 'County-level sales tax', applies_to: 'All taxable sales', type: 'county' },
                    { name: 'Fort Worth MTA', rate: 0.50, is_percentage: true, description: 'Metropolitan Transit Authority tax', applies_to: 'All taxable sales', type: 'special' }
                ]
            };

            const cityTaxes = {
                'austin': [{ name: 'Austin City Tax', rate: 2.00, is_percentage: true, description: 'City sales tax', applies_to: 'All taxable sales', type: 'local' }],
                'houston': [{ name: 'Houston City Tax', rate: 2.00, is_percentage: true, description: 'City sales tax', applies_to: 'All taxable sales', type: 'local' }],
                'dallas': [{ name: 'Dallas City Tax', rate: 2.00, is_percentage: true, description: 'City sales tax', applies_to: 'All taxable sales', type: 'local' }],
                'san-antonio': [{ name: 'San Antonio City Tax', rate: 2.00, is_percentage: true, description: 'City sales tax', applies_to: 'All taxable sales', type: 'local' }],
                'fort-worth': [{ name: 'Fort Worth City Tax', rate: 2.00, is_percentage: true, description: 'City sales tax', applies_to: 'All taxable sales', type: 'local' }]
            };

            let allTaxes = [...baseTaxes];
            
            if (countyTaxes[county]) {
                allTaxes = allTaxes.concat(countyTaxes[county]);
            }
            
            if (cityTaxes[city]) {
                allTaxes = allTaxes.concat(cityTaxes[city]);
            }

            const totalRate = allTaxes.filter(t => t.is_percentage).reduce((sum, tax) => sum + tax.rate, 0) / 100;

            return {
                taxes: allTaxes,
                totalRate: totalRate
            };
        }

        // Override the existing functions to use static data
        function scanTaxes() {
            const county = document.getElementById('county').value;
            const city = document.getElementById('city').value;
            const zip = document.getElementById('zip').value;

            if (!county) {
                showStatus('Please select a county', 'error');
                return;
            }

            showLoading(true);
            
            setTimeout(() => {
                const taxData = generateTaxData(county, city, zip);
                currentTaxData = {
                    location: { county, city, zip },
                    taxes: taxData.taxes,
                    totalRate: taxData.totalRate,
                    scanDate: new Date().toISOString()
                };
                displayTaxes(currentTaxData);
                showLoading(false);
                showStatus('Tax scan completed successfully!', 'success');
            }, 2000);
        }

        // Populate city dropdown
        function populateCityDropdown(cities) {
            const datalist = document.getElementById('city-list');
            datalist.innerHTML = '';
            
            cities.forEach(city => {
                const option = document.createElement('option');
                option.value = city.toLowerCase().replace(/\s+/g, '-');
                option.textContent = city;
                datalist.appendChild(option);
            });
        }

        // Update the county input handler
        document.addEventListener('DOMContentLoaded', function() {
            const countyInput = document.getElementById('county');
            const cityInput = document.getElementById('city');
            
            // Handle county input changes
            countyInput.addEventListener('input', function() {
                const countySlug = this.value.toLowerCase();
                
                // Clear city input
                cityInput.value = '';
                
                // Load cities for selected county
                if (countySlug && countyToCities[countySlug]) {
                    populateCityDropdown(countyToCities[countySlug]);
                }
            });
            
            // Handle county selection from datalist
            countyInput.addEventListener('change', function() {
                // Trigger input event to load cities
                this.dispatchEvent(new Event('input'));
            });
        });

        // Export functions
        function exportJSON() {
            if (!currentTaxData) {
                showStatus('Please scan taxes first', 'error');
                return;
            }
            
            const dataStr = JSON.stringify(currentTaxData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'texas-restaurant-taxes-' + Date.now() + '.json';
            link.click();
            URL.revokeObjectURL(url);
            showStatus('Tax data exported successfully!', 'success');
        }

        function exportCSV() {
            if (!currentTaxData) {
                showStatus('Please scan taxes first', 'error');
                return;
            }
            
            let csv = 'Tax Name,Rate,Description,Applies To,Type\n';
            currentTaxData.taxes.forEach(tax => {
                const rate = tax.is_percentage ? tax.rate + '%' : '$' + tax.rate;
                csv += '"' + tax.name + '","' + rate + '","' + tax.description + '","' + tax.applies_to + '","' + tax.type + '"\n';
            });
            
            const dataBlob = new Blob([csv], {type: 'text/csv'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'texas-restaurant-taxes-' + Date.now() + '.csv';
            link.click();
            URL.revokeObjectURL(url);
            showStatus('Tax data exported successfully!', 'success');
        }

        function showLoading(show) {
            const loading = document.getElementById('loading');
            if (loading) {
                loading.style.display = show ? 'block' : 'none';
            }
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            if (statusDiv) {
                statusDiv.innerHTML = '<div class="status-message status-' + type + '">' + message + '</div>';
                setTimeout(() => {
                    statusDiv.innerHTML = '';
                }, 5000);
            }
        }

        // Display taxes function
        function displayTaxes(taxData) {
            const taxGrid = document.getElementById('taxGrid');
            taxGrid.innerHTML = '';

            taxData.taxes.forEach(tax => {
                const taxCard = document.createElement('div');
                taxCard.className = 'tax-card ' + tax.type;
                taxCard.innerHTML = `
                    <div class="tax-name">${tax.name}</div>
                    <div class="tax-rate">${tax.is_percentage ? tax.rate + '%' : '$' + tax.rate}</div>
                    <div class="tax-description">${tax.description || 'No description available'}</div>
                    <div class="tax-applies-to"><strong>Applies to:</strong> ${tax.applies_to || 'All taxable sales'}</div>
                `;
                taxGrid.appendChild(taxCard);
            });

            // Add total rate summary
            const summaryCard = document.createElement('div');
            summaryCard.className = 'tax-card';
            summaryCard.style.background = 'linear-gradient(135deg, #74b9ff, #0984e3)';
            summaryCard.style.color = 'white';
            summaryCard.innerHTML = `
                <div class="tax-name" style="color: white;">Total Combined Rate</div>
                <div class="tax-rate" style="color: white;">${(taxData.totalRate * 100).toFixed(2)}%</div>
                <div class="tax-description" style="color: white;">Combined percentage rate for standard sales tax</div>
                <div class="tax-applies-to" style="background: rgba(255,255,255,0.1); color: white;"><strong>Note:</strong> Fixed fees are additional</div>
            `;
            taxGrid.appendChild(summaryCard);

            document.getElementById('results').classList.add('show');
        }
    </script>
</body>
</html>
